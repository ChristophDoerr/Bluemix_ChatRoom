<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>ChatRoom</title>
<style>
#chat {
	height: 500px;
}

#contentContainer {
	display: none;
}

#chatContainer {
	float: left;
	border: 1px #000 solid;
}
</style>
</head>
<body>
	<div id="nickContainer">
		<p>Enter a nickname:</p>
		<p id="nickNameChecker"></p>
		<form id="setNickname">
			<input size="35" id="nickname"></input> <input type="submit"></input>
		</form>
	</div>

	<div id="contentContainer">
		<div id="chatContainer">
			<div id="chat"></div>
			<form id="send-message">
				<input size="35" id="message"></input> <input type="submit"></input>
			</form>
		</div>
		<div id="user"></div>
	</div>


	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
		jQuery(function($) {
			var socket = io.connect();
			var $nickNameForm = $('#setNickname');
			var $nickNameChecker = $('#nickNameChecker');
			var $nickNameField = $('#nickname');
			var $users = $('#user')
			var $messageForm = $('#send-message');
			var $messageBox = $('#message');
			var $chat = $('#chat');

			$nickNameForm.submit(function(e) {
				e.preventDefault();
				socket.emit('new user', $nickNameField.val(), function(data) {
					if (data) {
						$('#nickContainer').hide();
						$('#contentContainer').show();
						

					} else {
						$nickNameChecker.html('Username is not usable!')
					}
				});
				$nickNameField.val('');
			});

			socket.on('usernames', function(data) {
				var html = '';
				for (i = 0; i < data.length; i++) {
					html += data[i] + '<br/>'
				}
				$users.html(html);
			});

			$messageForm.submit(function(e) {
				e.preventDefault();
				socket.emit('send message', $messageBox.val());
				$messageBox.val('');

			});
			socket.on('new message', function(data) {
				var time = new Date(data.time);
				
				$chat.append(time.getHours() + ':' + time.getMinutes() + ' Uhr ' + '<b>' +data.nick + ': </b>' + data.msg + "<br/>");
			});
			
			
			socket.on('new UserJoined', function(data) {
				$chat.append(data.nick  + ' has joined the room ' + '<br/>');
			});
			
			
			socket.on('new UserDisconnected', function(data) {
				$chat.append(data.nick  + ' has left the room ' + '<br/>');
			});
			
			
			
		});
	</script>
</body>
</html>